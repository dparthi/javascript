<html>
  <head>
    <title> 
    </title>
    <script language="javascript">
      //var deck = null
      var currentDeal = null
      //var suites = ["CLUBS","DIAMONDS","HEARTS","SPADES"]
      var suites = ["clubs","diamonds","hearts","spades"]
      //var ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K']
      var ranks = ['a','2','3','4','5','6','7','8','9','10','j','q','k']

      function initializeDeck() {
        deck = new Array(52)
        i = 0
        for(s = 0; s < suites.length; s++) {
          for(r = 0; r < ranks.length; r++) {
            card = new Object()
            card.suite = s
            card.rank = r
            deck[i] = card
            i++
          }
        }
        return deck
      }

      function game() {
        players = new Array(2)
        players[0] = new Object()
        players[0].id = 0
        players[1] = new Object()
        players[1].id = 1
        this.players = players

        decks = new Array(3)
        decks[0] = initializeDeck()
        decks[1] = initializeDeck()
        decks[2] = initializeDeck()
        this.decks = decks

        this.start = function() {
          shuffled_deck = shuffle(decks)
          deal(players, shuffled_deck)
          display_cards_for_each_player(players)
        }
      }

      function display_cards_for_each_player(players) {
        for(p = 0; p < players.length; p++) {
          display_card_images(players[p].currentHand, "cards-" + p)
        }
      }

      function shuffle(decks) {
        count = 0
        total_cards = decks.length * 52
        all_cards = new Array(total_cards)
        shuffled_deck = new Array(total_cards)
        for(d = 0; d < decks.length; d++) {
          for(c = 0; c < 52; c++) {
            all_cards[count] = decks[d][c]
            count++
          }
        }
        count = 0
        for(i = 0; i < total_cards; i++) {
          currentNumber = Math.floor(Math.random()*(total_cards - i))
          shuffled_deck[count] = all_cards[currentNumber]
          all_cards.splice(currentNumber,1)
          count++
        }
        return shuffled_deck
      }

      function deal(players, shuffled_deck) {
        for(i = 0; i < players.length; i++) {
          players[i].currentHand = new Array(13)
        }

        count = 0
        for(c = 0; c < 13; c++) {
          for(i = 0; i < players.length; i++) {
            players[i].currentHand[c] = shuffled_deck.pop()
            count++
          }
        }
        
        //return shuffled_deck
      }

      function pick_cards(count) {
        countArray = new Array(52)

        for(k = 0; k < 52; k++) {
          countArray[k] = k
        }

        cards_dealt = new Array(count)
        for(d = 0; d < count; d++) {
          currentNumber = Math.floor(Math.random()*(countArray.length))
          cards_dealt[d] = deck[countArray[currentNumber]]
          countArray.splice(currentNumber,1)
        }

        return cards_dealt
      }

      function display_cards_in_div(cards) {
        displayDiv = document.getElementById("cards")
        cards_dealt="<table border='1'>"
          for(c = 0; c < cards.length; c++) {
            currentCard = cards[c]
            cards_dealt = cards_dealt + "<tr><td>" + (c+1) + "</td><td>" + suites[currentCard.suite] + "</td><td>" + ranks[currentCard.rank] + "</td></tr>"
          }
          cards_dealt += "</table>"
        displayDiv.innerHTML = cards_dealt
      }

      function display_card_images(cards, divName) {
        count = 0
        rowFlag = "open"
        displayDiv = document.getElementById(divName)
        cards_dealt="<table>"
        for(c = 0; c < cards.length; c++) {
          currentCard = cards[c]
          if((count % 13) == 0) {
            cards_dealt = cards_dealt + "<tr>"
            rowFlag = "open"
          }
          cards_dealt = cards_dealt + "<td><img src='card-images/" + suites[currentCard.suite] + "-" + ranks[currentCard.rank] + "-75.png'></td>" 
          if((count % 13) == 12) {
            cards_dealt += "</tr>"
            rowFlag = "closed"
          }
          count++
        }
        if(rowFlag == "open") {
          cards_dealt += "</tr>"
          rowFlag = "closed"
        }
        displayDiv.innerHTML = cards_dealt
      }

      function display_cards(cards) {
        cards_dealt = ""
        document.myform.cards_dealt.value = cards_dealt
        for(c = 0; c < cards.length; c++) {
          currentCard = cards[c]
          cards_dealt = cards_dealt + (c+1) + " : " + currentCard.suite + " - " + currentCard.rank + "\n"
          document.myform.cards_dealt.value = cards_dealt
        }
      }

      function compareCards(card1, card2) {
        //how to sort //sort by suite //then sort by rank
        if(card1.suite == card2.suite) {
          return card1.rank - card2.rank
          } else {
          return card1.suite - card2.suite
        }
      }

      function sort() {
        if(null == currentDeal) {
          choice = confirm("Cards not dealt yet! Shall I deal first, before sorting?")
          if(choice) {
            deal()
            } else {
            return false
          }
        }

        if(null == currentDeal) {
          return false
        }

        currentDeal.sort(compareCards)
        display_card_images(currentDeal)
      }

      function play() {
        numberOfPlayers = Number(document.myform.number_of_players.value)
        numberOfDecks = Number(document.myform.number_of_decks.value)
        game = new game(numberOfPlayers, numberOfDecks)
        game.start()
      }
    </script>
  </head>
  <body>
    <form name="myform">
      Number Of Players: <input type="text" name="number_of_players" value=""/></br>
      Number Of Decks: <input type="text" name="number_of_decks" value=""/></br>
      <input type="button" name="dealer" value="play!" onclick="play()"/><br/>
      <input type="button" name="sorter" value="sort!" onclick="sort()"/><br/>
      <div id="cards"></div>
      <div id="cards-0"></div>
      <div id="cards-1"></div>
      <div id="cards-2"></div>
      <div id="cards-3"></div>
      <div id="cards-4"></div>
    </form>
  </body>
</html>

